DIJKSTRA =LAMBDA(current_cell,map_cell,blocked_cells,diag, IF(diag = 1, IF(MAX(IF(COUNTIF(map_cell, blocked_cells), 1, 0)) = 0, MIN(INDIRECT(Loc.SHIFT_OOB(CELL("address", current_cell), -1, -1) & ":" & Loc.SHIFT_OOB(CELL("address", current_cell), 1, 1))) + map_cell, 999), IF(MAX(IF(COUNTIF(map_cell, blocked_cells), 1, 0)) = 0, MIN(INDIRECT(Loc.SHIFT_OOB(CELL("address", current_cell), 1, 0)), INDIRECT(Loc.SHIFT_OOB(CELL("address", current_cell), -1, 0)), INDIRECT(Loc.SHIFT_OOB(CELL("address", current_cell), 0, -1)), INDIRECT(Loc.SHIFT_OOB(CELL("address", current_cell), 0, 1))) + map_cell, 999)));